# Review System Documentation

## Overview

The review system is fully implemented following the MongoDB schema structure. It allows users to create, read, update, and delete reviews for products.

## Schema Structure

### Review Model (MongoDB)

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  productId: ObjectId,         // Reference to Product (required, indexed)
  userId: ObjectId | null,     // Reference to User (nullable for guest reviews)
  content: String,             // Review text content (required)
  createdAt: Date,            // Auto-generated timestamp
}
```

## Features

### ✅ Implemented Features

1. **CRUD Operations**
   - ✅ Create review (POST)
   - ✅ Read reviews (GET)
   - ✅ Update review (PATCH)
   - ✅ Delete review (DELETE)

2. **Query & Filtering**
   - ✅ Get reviews by product ID
   - ✅ Get reviews by user ID
   - ✅ Pagination support (limit, skip)
   - ✅ Sorting (by date, helpful count)
   - ✅ Get single review by ID

3. **User Integration**
   - ✅ User data population in reviews
   - ✅ Guest reviews support (userId can be null)
   - ✅ User authentication integration

4. **React Hooks**
   - ✅ `useReviews` - Manage product reviews
   - ✅ `useReview` - Manage single review
   - ✅ `useUserReviews` - Manage user's reviews

## API Endpoints

### Get Product Reviews
```
GET /api/products/:productId/reviews?limit=10&skip=0&sortBy=createdAt&sortOrder=desc
```

**Response:**
```json
{
  "reviews": [
    {
      "_id": "673a1b2c4d5e6f7a8b9c0d01",
      "productId": "1",
      "userId": "user1",
      "content": "Great product!",
      "createdAt": "2024-11-17T10:00:00Z",
      "user": {
        "_id": "user1",
        "fullname": "John Doe",
        "email": "john@example.com"
      }
    }
  ],
  "total": 25,
  "hasMore": true,
  "skip": 0,
  "limit": 10
}
```

### Get Single Review
```
GET /api/reviews/:reviewId
```

### Create Review
```
POST /api/products/:productId/reviews
Content-Type: application/json

{
  "content": "Excellent product! Highly recommended.",
  "userId": "user1"  // Optional - null for guest reviews
}
```

**Response:**
```json
{
  "success": true,
  "message": "Review created successfully",
  "review": {
    "_id": "673a1b2c4d5e6f7a8b9c0d35",
    "productId": "1",
    "userId": "user1",
    "content": "Excellent product! Highly recommended.",
    "createdAt": "2024-11-17T10:30:00Z",
    "user": {
      "_id": "user1",
      "fullname": "John Doe",
      "email": "john@example.com"
    }
  }
}
```

### Update Review
```
PATCH /api/reviews/:reviewId
Content-Type: application/json

{
  "content": "Updated review content"
}
```

### Delete Review
```
DELETE /api/reviews/:reviewId
```

### Get User Reviews
```
GET /api/users/:userId/reviews?limit=10&skip=0
```

**Response includes product data:**
```json
{
  "reviews": [
    {
      "_id": "673a1b2c4d5e6f7a8b9c0d01",
      "productId": "1",
      "userId": "user1",
      "content": "Great product!",
      "createdAt": "2024-11-17T10:00:00Z",
      "product": {
        "_id": "1",
        "name": "Premium Keychain Set",
        "slug": "premium-keychain-set",
        "imageUrls": ["..."]
      }
    }
  ],
  "total": 5,
  "hasMore": false
}
```

## Usage Examples

### Using the Review Service

```javascript
import { 
  getProductReviews,
  createReview,
  updateReview,
  deleteReview,
  getUserReviews
} from '../services/reviews.service';

// Get product reviews
const reviews = await getProductReviews('product123', {
  limit: 10,
  skip: 0,
  sortBy: 'createdAt',
  sortOrder: 'desc'
});

// Create a review
const newReview = await createReview('product123', {
  content: 'This product is amazing!',
  userId: 'user1' // or null for guest
});

// Update a review
const updated = await updateReview('review123', {
  content: 'Updated review content'
});

// Delete a review
await deleteReview('review123');

// Get user's reviews
const userReviews = await getUserReviews('user1', { limit: 20 });
```

### Using React Hooks

```javascript
import { useReviews, useUserReviews } from '../hooks';

function ProductPage({ productId, userId }) {
  const {
    reviews,
    loading,
    error,
    total,
    hasMore,
    loadMore,
    addReview,
    editReview,
    removeReview,
    checkUserReview
  } = useReviews(productId);

  const handleSubmitReview = async (content) => {
    try {
      await addReview({
        content,
        userId: userId || null
      });
      alert('Review submitted!');
    } catch (err) {
      alert(err.message);
    }
  };

  return (
    <div>
      <h2>Reviews ({total})</h2>
      {reviews.map(review => (
        <div key={review._id}>
          <p>{review.user?.fullname || 'Guest'}</p>
          <p>{review.content}</p>
        </div>
      ))}
      {hasMore && <button onClick={loadMore}>Load More</button>}
    </div>
  );
}
```

### Using ReviewList Component

```javascript
import ReviewList from '../components/common/ReviewList';

function ProductDetailPage() {
  const currentUserId = 'user1'; // from auth context

  return (
    <div>
      {/* Product details */}
      
      <ReviewList 
        productId="product123"
        currentUserId={currentUserId}
      />
    </div>
  );
}
```

## Mock Data

The system includes 52 mock reviews across 20 products:
- Mix of authenticated user reviews and guest reviews
- Realistic review content
- Proper MongoDB ObjectId format for IDs
- Timestamped with various dates

## File Structure

```
src/
├── mocks/
│   ├── mockReviews.js           # Mock review data
│   ├── mockUsers.js              # Mock user data
│   └── handlers.js               # MSW API handlers
├── services/
│   ├── reviews.service.js        # Review API service
│   └── index.js                  # Service exports
├── hooks/
│   ├── useReviews.js             # Review hooks
│   └── index.js                  # Hook exports
├── components/
│   └── common/
│       └── ReviewList.jsx        # Review list component
└── utils/
    └── formatDate.js             # Date formatting utility
```

## Key Features

1. **User Popula tion**: Reviews automatically include user data when fetched
2. **Guest Reviews**: Support for reviews without user authentication (userId: null)
3. **Pagination**: Efficient loading of large review sets
4. **Sorting**: Sort by date or helpfulness
5. **CRUD Operations**: Full create, read, update, delete support
6. **React Hooks**: Easy integration with React components
7. **Error Handling**: Comprehensive error handling and validation
8. **TypeScript-Ready**: PropTypes included for type checking

## Validation Rules

- **content**: Required, cannot be empty or whitespace-only
- **productId**: Must reference existing product
- **userId**: Optional (null for guest reviews), must reference existing user if provided

## Future Enhancements

Potential features to add:
- Rating system (1-5 stars)
- Review images/media
- Helpful/unhelpful voting
- Review moderation
- Review replies
- Verified purchase badges
- Review statistics/analytics

## Notes

- All reviews are stored in localStorage for demo purposes
- Mock reviews use realistic MongoDB ObjectId format
- User data is automatically populated from mockUsers
- Guest reviews (userId: null) are fully supported
- Reviews are sorted by date (newest first) by default
